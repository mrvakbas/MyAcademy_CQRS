@model List<AppLog>

@{
    ViewData["Title"] = "Sistem Logları";
    Layout = "~/Areas/Admin/Views/_AdminLayout.cshtml";
}

<style>
    .mod-contact {
        background-color: #f3e5f5 !important;
        color: #7b1fa2 !important;
        border: 1px solid #e1bee7;
    }

    .mod-product {
        background-color: #e3f2fd !important;
        color: #0d47a1 !important;
        border: 1px solid #bbdefb;
    }

    .mod-order {
        background-color: #e8f5e9 !important;
        color: #2e7d32 !important;
        border: 1px solid #c8e6c9;
    }

    .mod-category {
        background-color: #fff8e1 !important;
        color: #ff8f00 !important;
        border: 1px solid #ffecb3;
    }

    .mod-promotion {
        background-color: #fff1f0 !important;
        color: #f5222d !important;
        border: 1px solid #ffa39e;
    }

    .mod-default {
        background-color: #f8fafc !important;
        color: #64748b !important;
        border: 1px solid #e2e8f0;
    }

    .timeline-item:hover .timeline-card {
        background-color: #ffffff !important;
        border-color: #6366f1 !important;
        transition: all 0.3s ease;
        transform: translateX(8px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.05) !important;
    }

    .timeline-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 20px;
        height: 100%;
        width: 2px;
        background: #e2e8f0;
    }
</style>

<div class="container-fluid pt-4">
    <div class="card border-0 shadow-sm overflow-hidden" style="border-radius: 15px;">
        <div class="card-header bg-white py-4 px-4 border-bottom-0">
            <div class="row align-items-center">
                <div class="col-md-7">
                    <h4 class="fw-bold text-dark mb-1"><i class="fas fa-history me-2 text-indigo"></i>Sistem Aktivite Akışı</h4>
                    <p class="text-muted small mb-0">Toplam <b>@Model.Count</b> kayıt analiz ediliyor.</p>
                </div>
                <div class="col-md-5">
                    <div class="input-group shadow-sm rounded-pill overflow-hidden border">
                        <span class="input-group-text bg-white border-0 ps-3">
                            <i class="fas fa-search text-primary"></i>
                        </span>
                        <input type="text" id="timelineSearch" class="form-control border-0 py-2 shadow-none"
                               placeholder="Mesaj veya modül ara..."
                               style="font-size: 0.9rem;">
                    </div>
                </div>
            </div>
        </div>

        <div class="card-body p-4">
            <div class="timeline-container position-relative" id="activityTimeline">
                @foreach (var log in Model.OrderByDescending(x => x.LogDate))
                {
                    // Modüle göre renk ve ikon belirleme
                    var modInfo = log.Module?.ToLower() switch
                    {
                        "contact" => (Class: "mod-contact", Icon: "fa-envelope", Border: "#7b1fa2"),
                        "product" => (Class: "mod-product", Icon: "fa-box", Border: "#0d47a1"),
                        "order" => (Class: "mod-order", Icon: "fa-shopping-cart", Border: "#2e7d32"),
                        "category" => (Class: "mod-category", Icon: "fa-list", Border: "#ff8f00"),
                        "promotion" => (Class: "mod-promotion", Icon: "fa-bullhorn", Border: "#f5222d"),
                        _ => (Class: "mod-default", Icon: "fa-cog", Border: "#64748b")
                    };

                    <div class="timeline-item position-relative mb-4 ps-5 searchable-item">
                        <div class="position-absolute rounded-circle d-flex align-items-center justify-content-center shadow-sm"
                             style="left: 0; width: 42px; height: 42px; background: white; z-index: 1; border: 2px solid @modInfo.Border;">
                            <i class="fas @modInfo.Icon small" style="color: @modInfo.Border;"></i>
                        </div>

                        <div class="p-3 rounded-4 border shadow-none timeline-card @modInfo.Class">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <span class="badge rounded-pill px-3 shadow-sm" style="background: white; color: @modInfo.Border; border: 1px solid @modInfo.Border;">
                                    @log.Module.ToUpper()
                                </span>
                                <small class="text-muted fw-bold">
                                    <i class="far fa-clock me-1"></i>@log.LogDate.ToString("HH:mm")
                                    <span class="ms-2 opacity-75">@log.LogDate.ToString("dd MMM yyyy")</span>
                                </small>
                            </div>

                            <h6 class="fw-bold mb-1 log-message" style="font-size: 0.95rem;">@log.Message</h6>
                        </div>
                    </div>
                }
            </div>

            <div id="noResult" class="text-center py-5 d-none">
                <i class="fas fa-search-minus fa-3x text-light mb-3"></i>
                <p class="text-muted">Aradığınız kriterlere uygun kayıt bulunamadı.</p>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('timelineSearch').addEventListener('keyup', function () {
        const searchText = this.value.toLowerCase();
        const items = document.querySelectorAll('.searchable-item');
        let hasVisibleItem = false;

        items.forEach(item => {
            const message = item.querySelector('.log-message').textContent.toLowerCase();
            const moduleName = item.querySelector('.badge').textContent.toLowerCase();

            if (message.includes(searchText) || moduleName.includes(searchText)) {
                item.style.setProperty('display', 'block', 'important');
                hasVisibleItem = true;
            } else {
                item.style.setProperty('display', 'none', 'important');
            }
        });

        const noResult = document.getElementById('noResult');
        noResult.classList.toggle('d-none', hasVisibleItem);
    });
</script>